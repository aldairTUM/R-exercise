---
title: "Exercise 6: Logistic Regression on Blood Donation Data"
author: "Aldair Leon"
date: "2025-08-04"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## 6(a) Load Dataset and Fit Models

```{r}
library(tidyverse)

# Load dataset
abs_path_dataset <- file.path(setwd(dirname(rstudioapi::getSourceEditorContext()$path)), "data","Donors.csv")
donors <- read.csv(abs_path_dataset, sep=",")

# 2. Fit logistic regression: donation ~ frequency
model1 <- glm(donation ~ frequency, data = donors, family = binomial)
summary(model1)

# 3. Fit logistic regression: donation ~ amount
model2 <- glm(donation ~ amount, data = donors, family = binomial)
summary(model2)

# 4. Plot frequency vs amount
ggplot(donors, aes(x = frequency, y = amount)) +
  geom_point(color = "black", size = 0.5) +
  labs(title = "Frequency vs Amount",
       x = "Total Donations (frequency)",
       y = "Total Blood Donated (amount in cc)") +
  theme_minimal()
```

## 6(b) Fit Model with `recency` and All Link Functions

```{r}
# Logit
logit_model <- glm(donation ~ recency, data = blood, family = binomial(link = "logit"))

# Probit
probit_model <- glm(donation ~ recency, data = blood, family = binomial(link = "probit"))

# Cloglog
cloglog_model <- glm(donation ~ recency, data = blood, family = binomial(link = "cloglog"))

summary(logit_model)
summary(probit_model)
summary(cloglog_model)
```

## 6(c) Classification and Evaluation

```{r}
# Split data
set.seed(1122)
train_idx <- sample(1:nrow(blood), 374)
blood_train <- blood[train_idx, ]
blood_test  <- blood[-train_idx, ]

# Fit model on training set
model_glm <- glm(donation ~ recency + frequency + amount + time, data = blood_train, family = binomial())

# Predict probabilities
pred_probs <- predict(model_glm, newdata = blood_test, type = "response")

# Classification (threshold = 0.5)
pred_labels <- ifelse(pred_probs >= 0.5, 1, 0)

# Classification error
ce <- mean(abs(blood_test$donation - pred_labels))
ce
```
